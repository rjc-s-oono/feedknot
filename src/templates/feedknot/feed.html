{% extends "base.html" %}

{# == ↓タイトル部分 ====================================== #}
{% block title %}&nbsp;|&nbsp;フィード{% endblock %}
{# == ↑タイトル部分 ====================================== #}

{# == ↓スタイルシート部分 ====================================== #}
{% block include_css %}
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
{% endblock %}
{# == ↑スタイルシート部分 ====================================== #}

{# == ↓ジャバスクリプト部分 ====================================== #}
{% block include_js %}
<script type="text/javascript">
<!--
    function deleteFedd(feed_id) {
        if (!startLoadingEffect("Adding...")) {
            return;
        }

        var $deleteFeddForm = $('#feed-delete-form');
        $('#feed_id').val(feed_id);

        $.ajax({
            type: 'POST',
            url: $deleteFeddForm.attr('action'),
            data: $deleteFeddForm.serialize(),
            dataType: "json",
            success: function(data, status) {
                var template  = _.template($('#feed-list-template').text());
                $("#feed-list").html(template(data)).listview('refresh');
            },
            error: function(XMLHttpRequest, statusText, errorThrown) {
                var errorMsg="Javascript Error:"+XMLHttpRequest.status+" "+XMLHttpRequest.statusText+", "
                errorMsg="error detail: "+errorThrown
                logger.error(errorMsg);
            },
            complete: function() {
                finishLoadingEffect();
            }
        });
    }
//-->
</script>
{% endblock %}
{# == ↑ジャバスクリプト部分 ====================================== #}

{# == ↓表示部分 ====================================== #}
{% block content %}
    <div id="main"  data-role="page">

        {# == タイトルバー ========== #}
        <div data-role="header" data-position="fixed" data-theme="e">
            {# ホームボタン #}
            <a href="{% url 'main' %}" data-iconpos="notext" data-icon="home" rel="external">ホーム</a>

            {# タイトル #}
            <h1 id="title">{{box_name}}</h1>

            {# 戻るボタン #}
            <a href="{% url 'common_edit' %}" data-iconpos="notext" data-icon="arrow-l" rel="external">戻る</a>
        </div> <!-- header -->

        {# == ↓ポップアップ内容  ========== #}
        <div data-role="popup" id="popupNotice">
            <div data-role="content" data-theme="d" class="ui-corner-bottom ui-content" id="popupMsg">
            </div>
        </div>
        {# == ↑ポップアップ内容  ========== #}

        {# == ↓検索ボックス ========== #}
        <div class="search_frame" >
            <input type="search" name="search" id="searc-basic" value="" data-mini="true" class="search_box" placeholder="RSS検索ワードを入力してください。" onchange="searchFeed(this.value);" />
        </div>
        {# == ↑検索ボックス ========== #}

        {# == ↓フィード情報  ========== #}
        <div data-role="content">
            <form id="feed-delete-form" method="post" action="{% url 'feed_delete' box_id %}">
                 <input type="hidden" id="feed_id" name="feed_id" value="" />
                 {% csrf_token %}
            </form>
            <ul id="feed-list" data-role="listview" data-divider-theme="e" data-inset="true" data-filter="true">
            {% for feed in feed_list %}
                <li data-theme="c">
                    <h1>{{feed.feed_name}}</h1>
                    <p>
                        FeedId={{feed.id}},
                        BoxId={{feed.box_id}},
                        UserId={{feed.user_id}},
                        priority={{feed.feed_priority}}

                    </p>
                    <a href="#" onclick="deleteFedd({{feed.id}})">feed削除</a>
                </li>
            {% endfor %}
            </ul>
            <a href="{% url 'feed_search' box_id %}" rel="external">feed追加</a>
        </div>
        {# == ↑フィード情報  ========== #}

        {# == 会社ロゴ  ========== #}
        {% include 'footer.html' %}
    </div> <!-- main -->

    <script type="text/template" id="feed-list-template">
        <% _.each(feed_list, function(feed) { %>
            <li data-theme="c">
                <h1><%= feed.feed_name %></h1>
                <p>
                    FeedId=<%= feed.id %>,
                    BoxId=<%= feed.box.id %>,
                    UserId=<%= feed.user.id %>,
                    priority=<%= feed.feed_priority %>
                </p>
                <a href="#" onclick="deleteFedd(<%= feed.id %>)">feed削除</a>
            </li>
        <% }); %>
    </script>
{% endblock %}
{# == ↑表示部分 ====================================== #}
