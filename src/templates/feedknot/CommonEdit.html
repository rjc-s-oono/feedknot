{% extends "base.html" %}

{# == ↓タイトル部分 ====================================== #}
{% block title %}&nbsp;|&nbsp;管理{% endblock %}
{# == ↑タイトル部分 ====================================== #}

{# == ↓スタイルシート部分 ====================================== #}
{% block include_css %}
{% endblock %}
{# == ↑スタイルシート部分 ====================================== #}

{# == ↓ジャバスクリプト部分 ====================================== #}
{% block include_js %}
{% endblock %}
{# == ↑ジャバスクリプト部分 ====================================== #}

{# == ↓表示部分 ====================================== #}
{% block content %}

    <div id="commonEdit" data-role="page">

        {# jquery mobileによって非同期で読み込まれるので[data-role="page"]内に記述する #}
        <script src="/media/js/box.js?{{ QUERY_STRING }}"></script>
        <script type="text/javascript">
        <!--
            $(function(){
                $('#box-list').on('click', '.box-info .edit-button', function(){
                    var box_id = $(this).attr('data-box-id');
                    var box_name = $('#box_name_'+box_id).val();
                    editBoxName(box_id, box_name);
                });

                $('#box-list').on('click', '.box-info .delete-button', function(){
                    var box_id = $(this).attr('data-box-id');
                    deleteBox(box_id);
                });

                $('#box-list').on('click', '.box-under-info .priority-icon', function(){
                    var box_id = $(this).parents('td.box-priority').attr('data-box-id');
                    var box_priority = $(this).attr('data-box-priority');
                    editBoxPriority(box_id, box_priority);
                });
            });
        //-->
        </script>

        {# == ヘッダ  ========== #}
        <div data-role="header" data-position="fixed" data-theme="e">
            <a href="{% url 'main' %}" data-iconpos="notext" data-icon="home" rel="external">ホーム</a>
            <H3>登録フィード</H3>
            <a href="{% url 'index' %}" data-prefetch="false" data-transition="slide" data-direction="reverse" data-iconpos="notext" data-icon="back">戻る</a>
        </div>
        {# == ↑ヘッダ  ========== #}

        {# == フィードメニュー  ========== #}
        <div data-role="content">

            <form id="box-edit-name-from" method="post" action="{% url 'box_edit_name' %}" name="box-edit-name-from">
                 <input type="hidden" id="edit_name_box_id" name="box_id" value="" />
                 <input type="hidden" id="box_name" name="box_name" value="" />
                 {% csrf_token %}
            </form>
            <form id="box-edit-priority-from" method="post" action="{% url 'box_edit_priority' %}" name="box-edit-priority-from">
                 <input type="hidden" id="edit_priority_box_id" name="box_id" value="" />
                 <input type="hidden" id="box_priority" name="box_priority" value="" />
                 {% csrf_token %}
            </form>
            <form id="box-delete-form" method="post" action="{% url 'box_delete' %}" name="box-delete-form">
                 <input type="hidden" id="delete_box_id" name="box_id" value="" />
                 {% csrf_token %}
            </form>

            <table id="box-list" cellspacing="0">
                {% for box in box_list %}
                    <tr class="box-info" bgcolor="silver">
                        <td rowspan="2" nowrap>
                            <input type="checkbox" id="box_default_{{box.id}}" class="box_default" />
                        </td>

                        <td align="left">
                            <textarea id="box_name_{{box.id}}" class="box_name" name="box_name" ROWS="1" COLS="20" >{{box.box_name}}</textarea>
                        </td>

                        <td width="10%" nowrap>
                            <img class="edit-button" data-box-id="{{box.id}}" src="/media/drawable/ic_edit.png?{{ QUERY_STRING }}" alt="edit" width="50" height="50">
                        </td>
                        <td width="10%" nowrap>
                            <img class="delete-button" data-box-id="{{box.id}}" src="/media/drawable/ic_delete.png?{{ QUERY_STRING }}" alt="delete" width="50" height="50">
                        </td>
                    </tr>
                    <tr class="box-under-info" bgcolor="silver">
                        <td class="box-priority" data-box-id="{{box.id}}" align="right" width="100%" height="8%" border-bottom>
                            <span class="priority-icon" data-box-priority="1">{% if box.box_priority >= 1 %}★{% else %}☆{% endif %}</span><!--
                            --><span class="priority-icon" data-box-priority="2">{% if box.box_priority >= 2 %}★{% else %}☆{% endif %}</span><!--
                            --><span class="priority-icon" data-box-priority="3">{% if box.box_priority == 3 %}★{% else %}☆{% endif %}</span><!--
                            -->現優先度{{box.box_priority}}
                        </td>
                        <td colspan="2" align="right" ><a href="{% url 'feed_list' box.id %}" rel="external">フィード管理</a></td>
                    </tr>
                {% endfor %}
                    <tr>
                        <td colspan="3" align="right" ><a href="{% url 'box_add' %}" rel="external">BOX追加</a></td>
                    </tr>
            </table>
        </div>
        {# == ↑フィードメニュー  ========== #}

        {# == フッタ  ========== #}
        {% include 'footer.html' %}

        <script type="text/template" id="box-list-template">
            <% _.each(box_list, function(box) { %>
                <tr class="box-info" bgcolor="silver">
                    <td rowspan="2" nowrap>
                        <input type="checkbox" id="box_default_<%= box.id %>" class="box_default" />
                    </td>
                    <td align="left">
                        <textarea id="box_name_<%= box.id %>" class="box_name" name="box_name" ROWS="1" COLS="20" ><%= box.box_name %></textarea>
                    </td>
                    <td width="10%" nowrap>
                        <img class="edit-button" data-box-id="<%= box.id %>" src="/media/drawable/ic_edit.png?{{ QUERY_STRING }}" alt="edit" width="50" height="50">
                    </td>
                    <td width="10%" nowrap>
                        <img class="delete-button" data-box-id="<%= box.id %>" src="/media/drawable/ic_delete.png?{{ QUERY_STRING }}" alt="delete" width="50" height="50">
                    </td>
                </tr>
                <tr class="box-under-info" bgcolor="silver">
                    <td class="box-priority" data-box-id="<%= box.id %>"  align="right" width="100%" height="8%" border-bottom>
                        <span class="priority-icon" data-box-priority="1"><% if(box.box_priority >= 1) { %>★<% } else { %>☆<% } %></span><!--
                        --><span class="priority-icon" data-box-priority="2"><% if(box.box_priority >= 2) { %>★<% } else { %>☆<% } %></span><!--
                        --><span class="priority-icon" data-box-priority="3"><% if(box.box_priority == 3) { %>★<% } else { %>☆<% } %></span><!--
                        -->現優先度<%= box.box_priority %>
                    </td>
                    <td colspan="2" align="right" ><a href="<%= box.feed_list_url %>" rel="external">フィード管理</a></td>
                </tr>
            <% }); %>
            <tr>
                <td colspan="3" align="right" ><a href="{% url 'box_add' %}" rel="external">BOX追加</a></td>
            </tr>
        </script>
    </div>

{% endblock %}
{# == ↑表示部分 ====================================== #}
